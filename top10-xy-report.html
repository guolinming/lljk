<!DOCTYPE html>
<html>
<head>
    <title>Top10用户报表</title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8"/>
    <meta name="author" content="www.frebsite.nl"/>
    <meta name="viewport" content="width=device-width initial-scale=1.0 maximum-scale=1.0 user-scalable=yes"/>
    <link href="img/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link type="text/css" rel="stylesheet" href="css/style.css"/>
    <link type="text/css" rel="stylesheet" href="css/flexslider.css"/>
    <link type="text/css" rel="stylesheet" href="css/jquery.mmenu.all.css"/>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/jquery.mmenu.min.all.js"></script>
    <script type="text/javascript" src="js/jquery.flexslider.js"></script>
    <script type="text/javascript" src="js/jquery.easy-pie-chart.js"></script>
    <script type="text/javascript" src="js/o-script.js"></script>
</head>
<body class="o-page">
<div id="page">
<!-- Header -->
<div id="header">
    <a href="#menu"></a>
				<span id="Logo" class="svg">
                     流量监控
				</span>
    <a class="backBtn" href="javascript:history.back();"></a>
</div>
<div class="subHeader"><i class="i-blog i-small"></i>Top10协议报表</div>
<!-- Content -->
<div id="content">
    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div id="condition">
        请选择协议:
        <select id="xy" style="width: 30%">

        </select>
        <input id="detail" type="button" value="详情" style="float:right">
        <br>
        请选择时间段:
        <select id="period" style="width: 30%">
            <option value="0">1天</option>
            <option value="1">7天</option>
            <option value="2">30天</option>
            <option value="3">90天</option>
        </select>
    </div>

    <div id="main" style="height:700px;"></div>
    <!-- ECharts单文件引入 -->
    <script src="http://echarts.baidu.com/build/dist/echarts.js"></script>
    <script src="http://echarts.baidu.com/build/dist/chart/line.js"></script>
    <script src="./plugin/data/top10xy.js"></script>
    <script src="./plugin/util/dateformat.js"></script>
    <script type="text/javascript">
        var title = 'TOP10协议';
        var subtext = "";
        var xy_i = 0;
        var period_i = 0;
        $('#detail').click(function () {
            var xy_name = $('#xy option[value="'+$('#xy').val()+'"]').html();
            window.location.href = "top10-xy-user-report.html?xy=" + $('#xy').val()
                    +"&xy_name="+xy_name;
        });
        $('#period').change(function () {
            var period = $('#period').val();
            period_i = period;
            var xyHtml = ""
            $.each(top10xy[period_i].data, function (idx, item) {
                xyHtml += "<option value='" + idx + "' >" + item[0] + "</option>"
            });
            $('#xy').html(xyHtml);
            load(top10xy[period_i].data, xy_i);
            myChart.refresh();
        });
        $('#xy').change(function () {
            var a = $('#xy').val();
            xy_i = a;
            load(top10xy[period_i].data, xy_i);
            myChart.refresh();
        });
        $(document).ready(function () {
            //调用方法
            var xyHtml = ""
            $.each(top10xy[period_i].data, function (idx, item) {
                xyHtml += "<option value='" + idx + "' >" + item[0] + "</option>"
            });
            $('#xy').html(xyHtml);
            load(top10xy[period_i].data, xy_i);
        })
        $('#main').css('height', $(window).height() * 0.7);


        // 路径配置
        require.config({
            paths: {
                echarts: 'http://echarts.baidu.com/build/dist'
            }
        });
        var myChart;
        function load(data, index) {
            var items_name = new Array();
            var x_value = new Array();
            var series = new Array();
            $.each(data, function (idx, item) {
                if (index == idx) {
                    items_name.push(item[0]);
                    var serie;
                    var y_value = new Array();
                    $.each(item[1], function (idx2, item2) {
                        if (idx == index) {
                            var time = new Date(item2[0]);
                            var dt = time.format("MM.dd hh");
                            x_value.push(dt);
                        }
                        var yv = item2[1] / (1024 * 1024 * 1024);
                        y_value.push(yv);
                    });
                    title = item[0];
                    serie = {
                        name: '流量',
                        type: 'line',
                        smooth: true,
                        itemStyle: {normal: {areaStyle: {type: 'default'}}},
                        data: y_value};
                    series.push(serie);
                }
            });
            // 使用
            require(
                    [
                        'echarts',
                        'echarts/chart/line' // 使用柱状图就加载bar模块，按需加载
                    ],
                    function (ec) {
                        // 基于准备好的dom，初始化echarts图表
                        myChart = ec.init(document.getElementById('main'));
                        var option = {
                            title: {
                                text: title,
                                subtext: subtext,
                                x: 'center',
                                textStyle: {fontSize: 20, fontStyle: 'italic'}
                            },
                            tooltip: {
                                trigger: 'axis'
                            },
                            grid: {
                                x: 20,
                                x2: 5
                            },
                            xAxis: [
                                {
                                    type: 'category',
                                    boundaryGap: false,
                                    axisLine: {onZero: false},
                                    data: x_value
                                }
                            ],
                            yAxis: [
                                {
                                    axisLabel: {rotate: 70},
                                    name: '流量',
                                    nameTextStyle: {fontSize: 12},
                                    type: 'value'
                                }
                            ],
                            series: series
                        };

                        // 为echarts对象加载数据
                        myChart.setOption(option);
                    }
            );
        }
    </script>
</div>

<!-- Menu navigation -->
<nav id="menu">
    <ul>
        <li style="line-height: 30px;text-align: center">
            欢迎，张三
        </li>
        <li>
            <a href="index.html">
                <i class="i-home i-small"></i>终端信息
            </a>
        </li>
        <li>
            <a>
                <i class="i-about i-small"></i>流量监控
            </a>
            <ul>
                <li><a href="online-user-report.html">在线用户数报表</a></li>
                <li><a href="in-out-report.html">吞吐量报表</a></li>
                <li><a href="top10-user-report.html">Top10用户报表</a></li>
                <li class="Selected"><a href="top10-xy-report.html">Top10协议报表</a></li>
            </ul>
        </li>
        <li>
            <a href="action-analysis.html">
                <i class="i-blog i-small"></i>行为分析
            </a>
        </li>
        <li>
            <a href="business-statistics.html">
                <i class="i-gallery i-small"></i>企业统计
            </a>
        </li>
        <li>
            <a>
                <i class="i-shortcodes i-small"></i>系统分析
            </a>
            <ul>
                <li><a href="system-gprs-analysis.html">系统流量分布</a></li>
                <li><a href="distribution-system.html">系统分布</a></li>
            </ul>
        </li>
    </ul>
</nav>
</div>
</body>
</html>